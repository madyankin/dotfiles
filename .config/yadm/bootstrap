#!/bin/bash

set -e

# Exclude root README from worktree
if ! yadm sparse-checkout list &>/dev/null; then
  yadm sparse-checkout init --no-cone
  yadm sparse-checkout set '*' '!/README.md'
fi

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

log() { echo ""; echo "━━━ $1 ━━━"; }

case "$OSTYPE" in
  darwin*)
    log "macOS Defaults"
    ./scripts/macos.sh

    log "Homebrew"
    ./scripts/homebrew.sh

    # Accept Xcode license (if Xcode is installed)
    if [[ -d "/Applications/Xcode.app" ]]; then
      log "Xcode License"
      sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
      sudo xcodebuild -license accept
    fi

    log "iTerm2"
    ./scripts/iterm.sh

    log "Editors"
    ./scripts/editors.sh
    ;;

  linux*)
    log "Linux Setup"
    ./scripts/linux.sh
    ;;
esac

log "ZSH"
./scripts/zsh.sh

log "Cron"
./scripts/cron.sh

log "Agents"
./scripts/agents.sh

echo ""
echo "✓ Bootstrap complete"
